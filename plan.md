Google Keep ドラッグ＆ドロップメモ帳アップロード拡張機能 設計書
1. 概要
1.1 目的
Google Keepにテキストファイル（.txt）をドラッグ＆ドロップで簡単にアップロードし、新規ノートとして作成するブラウザ拡張機能を設計・開発する。

1.2 背景
Google Keepは便利なメモツールだが、既存のテキストファイルをインポートする機能が標準では限られている

ユーザーはローカルに保存されたメモ帳ファイルを簡単にKeepに移行したいというニーズがある

ドラッグ＆ドロップ操作による直感的なファイルアップロードを実現する

2. 機能要件
2.1 基本機能
ドラッグ＆ドロップ受付

Google Keepページ上でのファイルドロップを検知

対応ファイル形式: .txt (UTF-8, Shift-JISなど主要エンコーディング)

ファイル内容解析

テキストファイルの内容読み込み

文字エンコーディング自動判別

ファイル名をタイトル候補として利用

Keepノート自動作成

ファイル内容を本文として新規ノート作成

ファイル名をタイトルとして設定（オプション）

作成成功/失敗のフィードバック表示

2.2 拡張機能（将来対応）
複数ファイル一括アップロード

カスタムタグの自動付与

アップロード履歴の管理

他のテキスト形式（.md, .rtf）への対応

3. 技術仕様
3.1 アーキテクチャ
text
[Frontend Layer]
├── Content Script (Google Keepページに注入)
├── Drag & Drop Handler
├── File Reader
└── UI Feedback Component

[Background Layer]
├── Message Broker
├── Error Handler
└── Storage Manager (設定保存用)

[API Layer]
├── Google Keep API連携
└── File Processing Module
3.2 コンポーネント詳細
3.2.1 Content Script
javascript
// 主要機能:
// 1. ドロップゾーンの監視設定
// 2. ドラッグ&ドロップイベントハンドリング
// 3. Google KeepのDOM操作
// 4. ユーザーインターフェースの拡張
3.2.2 File Processor
javascript
// 主要機能:
// 1. ファイル読み込み (FileReader API)
// 2. 文字コード判定 (chardetection)
// 3. テキスト正規化
// 4. メタデータ抽出
3.2.3 Keep API Client
javascript
// 主要機能:
// 1. 新規ノート作成
// 2. 既存ノート操作
// 3. 認証状態管理
// 4. エラーハンドリング
3.3 データフロー
text
ユーザードラッグ＆ドロップ
    ↓
ファイル検証（形式、サイズ）
    ↓
テキスト内容読み込み
    ↓
文字エンコーディング変換
    ↓
Google Keep API呼び出し
    ↓
ノート作成結果表示
4. ユーザーインターフェース
4.1 視覚的フィードバック
ドロップゾーン表示

Keepページに透明なオーバーレイ表示

ファイルドロップ可能なことを示す視覚的合図

進行状況表示

アップロード中のプログレスバー

成功/失敗のトースト通知

設定インターフェース

オプションページでの設定管理

ファイル処理オプション（タイトル設定、タグ追加など）

4.2 操作フロー
text
1. ユーザーがGoogle Keepを開く
2. テキストファイルをブラウザウィンドウにドラッグ
3. ドロップゾーンがハイライト表示
4. ファイルをドロップ
5. 処理中のインジケータ表示
6. 完了通知と作成されたノートへのリンク表示
5. セキュリティ・プライバシー
5.1 セキュリティ対策
サンドボックス化されたファイル処理

ファイル内容はクライアント側でのみ処理

外部サーバーへのファイル送信なし

権限最小化

必要な権限のみ要求:

activeTab: Keepタブの制御

storage: 設定の保存

https://keep.google.com/*: Keepドメインへのアクセス

入力検証

ファイル形式の検証

ファイルサイズ制限（最大10MB）

マルウェアスキャン（基本的な検証）

5.2 プライバシー保護
ユーザーデータの外部送信なし

設定データのローカル保存のみ

匿名化されたエラーレポート（オプトイン）

6. 実装計画
6.1 開発フェーズ
Phase 1: 基本機能実装

単一テキストファイルのアップロード

基本エラーハンドリング

最小限のUIフィードバック

Phase 2: 機能拡張

複数ファイル対応

詳細な設定オプション

アップロード履歴

Phase 3: 最適化

パフォーマンス改善

ユーザビリティ向上

詳細なエラーメッセージ

6.2 技術スタック
言語: JavaScript (ES6+)

ブラウザ拡張: Manifest V3

ビルドツール: Webpack / Rollup

テスト: Jest, Puppeteer

UIコンポーネント: 軽量CSSフレームワーク

7. 制限事項と対応策
7.1 既知の制限
Google Keep APIの制限

レートリミット対応が必要

API変更への追従が必要

ブラウザ互換性

Chromeメインでの開発

Firefox, Edgeへの対応はフェーズ2以降

ファイル形式制限

初期は.txtのみ対応

バイナリファイルや画像は非対応

7.2 エラーハンドリング
ネットワークエラー時のリトライ機制

認証エラー時の再認証フロー

ファイル読み込みエラーの詳細表示

8. テスト計画
8.1 テストカテゴリ
ユニットテスト: 各モジュールの単体機能

統合テスト: コンポーネント間連携

E2Eテスト: ユーザーフロー全体

クロスブラウザテスト: 主要ブラウザ対応

8.2 テストシナリオ例
text
1. 有効な.txtファイルのドラッグ＆ドロップ
2. 無効なファイル形式の拒否
3. 大きなファイルサイズの処理
4. ネットワーク切断時の挙動
5. 複数ファイルの同時アップロード
9. 配布とメンテナンス
9.1 配布方法
Chrome Web Storeでの公開

オープンソースとしてGitHub公開

自動更新機制の実装

9.2 メンテナンス計画
月次バージョンチェック

Google Keep API変更の監視

ユーザーフィードバック収集と対応

セキュリティアップデートの迅速適用

付録
A. サンプルコード構造
text
extension/
├── manifest.json
├── background.js
├── content/
│   ├── content.js
│   ├── drop-handler.js
│   └── keep-client.js
├── popup/
│   ├── popup.html
│   ├── popup.js
│   └── popup.css
├── options/
│   ├── options.html
│   └── options.js
├── lib/
│   └── text-encoder.js
└── assets/
    ├── icons/
    └── styles/
B. 権限要求リスト
json
{
  "permissions": [
    "activeTab",
    "storage",
    "scripting"
  ],
  "host_permissions": [
    "https://keep.google.com/*"
  ]
}
この設計書に基づき、開発を進めることができます。実装前にはGoogle Keepの利用規約およびChrome拡張機能のポリシーを確認してください。
